<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Ruleta Europea - Mesa en Tabla</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root {
      --bg: #07270f; --txt: #fff; --gold: #ffd700; --shadow: 0 4px 12px rgba(0,0,0,.6);
      --red: #900; --black: #111; --green: #0a6000; --ok: #0f0; --warn: #ffcc00; --err: #ff6b6b;
    }
    * { box-sizing: border-box; margin: 0; padding: 0 }
    body {
      display: flex; flex-direction: column; align-items: center;
      background: var(--bg); color: var(--txt);
      font-family: system-ui,Segoe UI,Roboto,Arial,Helvetica,sans-serif;
      padding: 16px; overflow: auto;
    }
    h1,h3 { margin: .5em 0 }
    .row { display: flex; gap: 12px; flex-wrap: wrap; justify-content: center; align-items: center }
    select, button {
      padding: 10px 14px; font-size: 16px; font-weight: 600;
      border: none; border-radius: 10px;
    }
    button {
      cursor: pointer; background: var(--gold); color: #111;
      margin: 4px; box-shadow: var(--shadow); transition: transform .05s ease;
    }
    button:active { transform: translateY(1px) }
    button.secondary { background: #333; color: #fff }
    button.ghost { background: transparent; border: 1px solid #444; color: #ddd }
    button:disabled { opacity: .5; cursor: not-allowed }
    .legend { font-size: 13px; opacity: .9; margin-top: 8px; }
    .wrap { display: none; width: 100%; max-width: 1000px; margin-top: 12px }
    .top-wrap { display: flex; gap: 18px; flex-wrap: wrap; justify-content: center; }
    .ruleta-panel { flex:1; min-width:320px; background:#0a3a19; border-radius:12px; padding:12px; box-shadow:var(--shadow); text-align:center }
    canvas { background:#222; border-radius:50%; box-shadow:0 0 30px rgba(0,0,0,.7); max-width:90vw; height:auto }
    .status { display:flex; gap:12px; justify-content:center; margin-top:6px }
    #saldo { font-size:18px; color:var(--warn); font-weight:bold }
    #totalApuesta { font-size:16px; color:var(--ok); font-weight:bold }
    .controls { margin-top:10px }
    .fichas { margin-top:10px; background:#0c3f1e; border-radius:12px; padding:10px; text-align:center }
    .chips-row { display:flex; gap:6px; justify-content:center; flex-wrap:wrap }
    .chip { background:#ff0; color:#111; padding:8px 12px; border-radius:8px; cursor:pointer }
    .chip.selected { outline:3px solid #fff }
    .small { font-size:12px; opacity:.9; margin-top:4px }
    .mesa-wrap { margin-top:14px; text-align:center }
    .tabla-ruleta {
      background:#14351b; padding:16px; border-radius:16px;
      box-shadow:0 4px 16px rgba(0,0,0,0.6); overflow:auto; margin-bottom:12px;
    }
    .tabla-ruleta table {
      border-collapse: separate; border-spacing:6px; width:100%;
    }
    .tabla-ruleta td {
      width:60px; height:60px; text-align:center; vertical-align:middle;
      border-radius:8px; cursor:pointer; font-weight:700;
      transition:transform .1s,box-shadow .1s; position:relative;
    }
    .tabla-ruleta td.red { background:var(--red); color:#fff }
    .tabla-ruleta td.black { background:var(--black); color:#fff }
    .tabla-ruleta td.green { background:var(--green); color:#fff }
    .tabla-ruleta td:hover {
      transform:translateY(-2px); box-shadow:0 2px 8px rgba(0,0,0,0.5);
    }
    .badge {
      position:absolute; bottom:6px; right:6px;
      background:rgba(255,255,255,.9); color:#111;
      padding:4px 8px; border-radius:8px; font-size:12px; font-weight:700;
    }
    .externas {
      display:flex; flex-wrap:wrap; gap:8px; justify-content:center; margin-top:8px;
    }
    .externas button {
      padding:8px 14px; border-radius:8px; font-weight:600;
      transition:transform .1s,box-shadow .1s;
    }
    .externas button:hover {
      transform:translateY(-1px); box-shadow:0 2px 6px rgba(0,0,0,0.4);
    }
    .externas .red { background:var(--red); color:#fff }
    .externas .black { background:var(--black); color:#fff }
    .historial {
      margin-top:12px; background:#0c3f1e; border-radius:12px; padding:10px;
      max-height:180px; overflow-y:auto; font-size:13px;
    }
  </style>
</head>
<body>
  <h1>üé∞ Ruleta Europea</h1>
  <div id="croupierSelectWrap" class="row">
    <label for="croupierSelect">üé© Croupier:</label>
    <select id="croupierSelect">
      <option value="">--Selecciona--</option>
      <option value="anna">Anna</option>
      <option value="john">John</option>
      <option value="maria">Maria</option>
    </select>
    <button id="confirmCroupier">Confirmar</button>
    <button id="resetAll" class="ghost">Reiniciar</button>
    <div class="legend">üîß Bola: 8‚Äì12 vueltas. Tabla en varias filas.</div>
  </div>

  <div class="wrap" id="gameWrap">
    <div class="top-wrap">
      <div class="ruleta-panel">
        <canvas id="ruleta" width="500" height="500" aria-label="Ruleta"></canvas>
        <div class="controls">
          <button id="spin">üé∞ Girar</button>
          <button id="volverTirar" class="secondary" style="display:none;">üîÑ Repetir</button>
          <button id="quitarUltima" class="secondary">‚èÆÔ∏è Deshacer</button>
          <button id="quitarTodas" class="secondary">üóëÔ∏è Limpiar</button>
          <button id="duplicarApuestas" class="ghost">‚úñÔ∏è2 Duplicar</button>
        </div>
        <div id="resultado" aria-live="polite"></div>
        <div id="debug">Debug: listo</div>
        <div class="status">
          <div id="saldo">üí∞ Saldo: 1000 ‚Ç¨</div>
          <div id="totalApuesta">Total apostado: 0 ‚Ç¨</div>
        </div>
        <div class="fichas">
          <h3>üí∞ Fichas</h3>
          <div class="chips-row">
            <div class="chip selected" data-value="1">1 ‚Ç¨</div>
            <div class="chip" data-value="5">5 ‚Ç¨</div>
            <div class="chip" data-value="10">10 ‚Ç¨</div>
            <div class="chip" data-value="50">50 ‚Ç¨</div>
            <div class="chip" data-value="100">100 ‚Ç¨</div>
            <div class="chip" data-value="500">500 ‚Ç¨</div>
          </div>
          <div class="small">M√°x 1000 ‚Ç¨ casilla, 5000 ‚Ç¨ ronda. No apostar si saldo ‚â§ 0.</div>
        </div>
      </div>
    </div>

    <div class="mesa-wrap">
      <div class="tabla-ruleta">
        <table id="tablaNumeros">
          <tr>
            <td data-num="0" class="green">0</td><td data-num="32" class="red">32</td><td data-num="15" class="black">15</td><td data-num="19" class="red">19</td><td data-num="4" class="black">4</td><td data-num="21" class="red">21</td><td data-num="2" class="black">2</td><td data-num="25" class="red">25</td><td data-num="17" class="black">17</td><td data-num="34" class="red">34</td><td data-num="6" class="black">6</td><td data-num="27" class="red">27</td><td data-num="13" class="black">13</td>
          </tr>
          <tr>
            <td data-num="36" class="red">36</td><td data-num="11" class="black">11</td><td data-num="30" class="red">30</td><td data-num="8" class="black">8</td><td data-num="23" class="red">23</td><td data-num="10" class="black">10</td><td data-num="5" class="red">5</td><td data-num="24" class="black">24</td><td data-num="16" class="red">16</td><td data-num="33" class="black">33</td><td data-num="1" class="red">1</td><td data-num="20" class="black">20</td><td data-num="14" class="red">14</td>
          </tr>
          <tr>
            <td data-num="31" class="black">31</td><td data-num="9" class="red">9</td><td data-num="22" class="black">22</td><td data-num="18" class="red">18</td><td data-num="29" class="black">29</td><td data-num="7" class="red">7</td><td data-num="28" class="black">28</td><td data-num="12" class="red">12</td><td data-num="35" class="black">35</td><td data-num="3" class="red">3</td><td data-num="26" class="black">26</td>
          </tr>
        </table>
      </div>
      <div class="externas">
        <button data-bet="color" data-value="rojo" class="red">Rojo</button>
        <button data-bet="color" data-value="negro" class="black">Negro</button>
        <button data-bet="paridad" data-value="par">Par</button>
        <button data-bet="paridad" data-value="impar">Impar</button>
        <button data-bet="mitad" data-value="bajo">1-18</button>
        <button data-bet="mitad" data-value="alto">19-36</button>
        <button data-bet="docena" data-value="1">1-12</button>
        <button data-bet="docena" data-value="2">13-24</button>
        <button data-bet="docena" data-value="3">25-36</button>
      </div>
    </div>

    <div class="historial">
      <h3>üßæ Historial</h3>
      <ul id="historialLista"></ul>
    </div>
  </div>

  <script>
  (function(){
    const canvas=document.getElementById("ruleta"), ctx=canvas.getContext("2d");
    const W=500,H=500,cx=W/2,cy=H/2;
    const nums=[0,32,15,19,4,21,2,25,17,34,6,27,13,36,11,30,8,23,10,5,24,16,33,1,20,14,31,9,22,18,29,7,28,12,35,3,26];
    const reds=new Set([1,3,5,7,9,12,14,16,18,19,21,23,25,27,30,32,34,36]);
    const sector=2*Math.PI/nums.length;
    let bolaAng=0, spinning=false;
    let saldo=parseInt(localStorage.getItem("saldo_ruleta")||"1000",10), selChip=1;
    let bets=[], totalBet=0;
    const MAX_C=1000, MAX_R=5000;

    const bubble=document.getElementById("bubble"), saldoEl=document.getElementById("saldo");
    const totEl=document.getElementById("totalApuesta"), resEl=document.getElementById("resultado");
    const dbgEl=document.getElementById("debug"), spinBtn=document.getElementById("spin");
    const repBtn=document.getElementById("volverTirar"), histList=document.getElementById("historialLista");

    function decir(m){ bubble.textContent=m; }
    function updSaldo(){ saldoEl.textContent=`üí∞ Saldo: ${saldo} ‚Ç¨`; localStorage.setItem("saldo_ruleta",saldo); }
    function updTotal(){ totalBet=bets.reduce((a,b)=>a+b.amt,0); totEl.textContent=`Total apostado: ${totalBet} ‚Ç¨`; }
    function toggle(dis){ document.querySelectorAll(".chip,#tablaNumeros td,.externas button,#quitarUltima,#quitarTodas,#duplicarApuestas,#resetAll").forEach(e=>e.disabled=dis); }
    function mkBadge(e,v){ let b=e.querySelector(".badge"); if(!b){ b=document.createElement("span"); b.className="badge"; e.appendChild(b);} b.textContent=`‚Ç¨${v}`; }
    function clrBadge(e){ let b=e.querySelector(".badge"); if(b) b.remove(); }
    function addHist(m){ let li=document.createElement("li"); li.innerHTML=m; histList.prepend(li); if(histList.childElementCount>50) histList.removeChild(histList.lastChild); }

    function draw(){
      ctx.clearRect(0,0,W,H);
      let r=Math.min(W,H)/2-10;
      nums.forEach((n,i)=>{
        let a0=i*sector, a1=a0+sector;
        ctx.beginPath(); ctx.moveTo(cx,cy); ctx.arc(cx,cy,r,a0,a1); ctx.closePath();
        ctx.fillStyle = n===0?"#0a0":reds.has(n)?"#b00":"#222"; ctx.fill();
        ctx.strokeStyle="#fff"; ctx.lineWidth=1; ctx.stroke();
        ctx.save(); ctx.translate(cx,cy); ctx.rotate((a0+a1)/2);
        ctx.fillStyle="#fff"; ctx.textAlign="right"; ctx.font="bold 14px Arial";
        ctx.fillText(n,r-10,5); ctx.restore();
      });
      ctx.beginPath(); ctx.arc(cx,cy,40,0,2*Math.PI); ctx.fillStyle="#333"; ctx.fill();
      let br=r-20, x=cx+Math.cos(-bolaAng)*br, y=cy+Math.sin(-bolaAng)*br;
      ctx.beginPath(); ctx.arc(x,y,8,0,2*Math.PI); ctx.fillStyle="#fff"; ctx.fill();
      ctx.strokeStyle="#000"; ctx.lineWidth=2; ctx.stroke();
    }

    function getNum(){
      let ang=(-bolaAng)%(2*Math.PI); if(ang<0) ang+=2*Math.PI;
      let idx=Math.floor(ang/sector)%nums.length; dbgEl.textContent=`Debug: num=${nums[idx]}`; return nums[idx];
    }

    function animate(idx, repeat){
      let v=8+Math.random()*4, dur=3000+Math.random()*2000, start=Date.now(), init=bolaAng;
      let tgt=-(idx*sector+sector/2), delta=v*2*Math.PI+(tgt-init);
      (function frame(){
        let t=(Date.now()-start)/dur;
        if(t>=1){
          bolaAng=init+delta; draw(); let n=getNum();
          if(!repeat) finish(n); else{ resEl.textContent=`üîÅ √öltimo: ${n}`; spinning=false; toggle(false);}
          return;
        }
        let e=1-Math.pow(1-t,3); bolaAng=init+e*delta; draw(); requestAnimationFrame(frame);
      })();
    }

    function finish(n){
      spinning=false; resEl.textContent=`üéâ ¬°N√∫mero: ${n}!`;
      let win=0, m=new Map();
      bets.forEach(b=>{ let k=b.el; if(!m.has(k)) m.set(k,{...b}); else m.get(k).amt+=b.amt; });
      m.forEach(a=>{
        let ok=false;
        if(a.type==="numero") ok=Number(a.key)===n;
        if(a.type==="color") ok=(a.key==="rojo"?reds.has(n):(!reds.has(n)&&n!==0));
        if(a.type==="paridad") ok=(a.key==="par"?n%2===0:n%2===1);
        if(a.type==="mitad") ok=(a.key==="bajo"?n<=18:n>=19);
        if(a.type==="docena"){ let d=n<=12?1:n<=24?2:n===0?0:3; ok=Number(a.key)===d; }
        if(ok) win+=a.amt*(a.type==="numero"?36:(a.type==="docena"?3:2));
      });
      saldo+=win; updSaldo();
      if(win>0){ decir(`üèÜ ¬°Ganaste ‚Ç¨${win}!`); addHist(`‚úÖ ${n} +‚Ç¨${win}`); }
      else { decir(`üò¨ Sin premio`); addHist(`‚ùå ${n}`); }
      bets=[]; document.querySelectorAll("#tablaNumeros td,.externas button").forEach(e=>clrBadge(e));
      updTotal(); toggle(false);
    }

    spinBtn.addEventListener("click",()=>{
      if(spinning||saldo<=0||bets.length===0){ if(bets.length===0) alert("Apuesta primero"); return; }
      spinning=true; toggle(true);
      let n=nums[Math.floor(Math.random()*nums.length)], idx=nums.indexOf(n);
      animate(idx,false);
    });

    repBtn.addEventListener("click",()=>{
      if(spinning) return;
      let last=getNum(), idx=nums.indexOf(last);
      spinning=true; toggle(true); animate(idx,true);
    });

    document.querySelectorAll(".chip").forEach(c=>c.addEventListener("click",()=>{
      selChip=Number(c.dataset.value);
      document.querySelectorAll(".chip").forEach(x=>x.classList.remove("selected"));
      c.classList.add("selected");
    }));

    document.querySelectorAll("#tablaNumeros td,.externas button").forEach(e=>e.addEventListener("click",()=>{
      if(spinning||saldo<=0) return;
      let cur=parseInt(e.dataset.apuesta||"0",10), amt=selChip;
      if(cur+amt>MAX_C|| totalBet+amt>MAX_R|| saldo<amt) return;
      e.dataset.apuesta=cur+amt; mkBadge(e,cur+amt);
      saldo-=amt; updSaldo();
      let type=e.dataset.num?"numero":e.dataset.bet, key=e.dataset.num||e.dataset.value;
      bets.push({el:e,type,type,type,key,amt});
      updTotal(); addHist(`‚ûï ${type}-${key}:‚Ç¨${amt}`);
    }));

    document.getElementById("quitarUltima").addEventListener("click",()=>{
      if(spinning||!bets.length) return;
      let a=bets.pop(), cur=parseInt(a.el.dataset.apuesta||"0",10)-a.amt;
      if(cur>0) mkBadge(a.el,cur); else clrBadge(a.el);
      saldo+=a.amt; updSaldo(); updTotal(); addHist(`‚Ü©Ô∏è Undo ${a.type}-${a.key}:+‚Ç¨${a.amt}`);
    });

    document.getElementById("quitarTodas").addEventListener("click",()=>{
      if(spinning||!bets.length) return;
      bets.forEach(b=>saldo+=b.amt);
      document.querySelectorAll("#tablaNumeros td,.externas button").forEach(e=>clrBadge(e));
      bets=[]; updSaldo(); updTotal(); addHist("üóëÔ∏è Limpieza");
    });

    document.getElementById("duplicarApuestas").addEventListener("click",()=>{
      if(spinning||!bets.length||saldo<totalBet) return;
      let clone=[...bets]; clone.forEach(a=>{
        let cur=parseInt(a.el.dataset.apuesta||"0",10)+a.amt;
        a.el.dataset.apuesta=cur; mkBadge(a.el,cur);
        saldo-=a.amt; bets.push({...a});
      });
      updSaldo(); updTotal(); addHist(`‚úñÔ∏è2 +‚Ç¨${totalBet}`);
    });

    document.getElementById("confirmCroupier").addEventListener("click",()=>{
      let sel=document.getElementById("croupierSelect").value;
      if(!sel) return alert("Selecciona croupier");
      document.getElementById("gameWrap").style.display="block";
      updSaldo(); updTotal(); decir("üé≤ ¬°La suerte est√° echada!");
    });

    document.getElementById("resetAll").addEventListener("click",()=>{
      if(!confirm("¬øReiniciar?")) return;
      saldo=1000; localStorage.setItem("saldo_ruleta",saldo);
      bets=[]; document.querySelectorAll("#tablaNumeros td,.externas button").forEach(e=>clrBadge(e));
      updSaldo(); updTotal(); resEl.textContent=""; dbgEl.textContent="Debug: reiniciado"; addHist("üîÑ Reinicio"); decir("üéØ Reiniciado");
    });

    draw(); updSaldo(); updTotal();
  })();
  </script>
</body>
</html>
